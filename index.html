<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FLIP â€” Coin Flip Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --gold: #f7cc40;
      --gold2: #ffec8b;
      --gold-dark: #b8860b;
      --green: #00ff88;
      --red: #ff3355;
      --bg: #07070f;
      --surface: rgba(255,255,255,0.04);
      --border: rgba(255,255,255,0.08);
      --text: #f0f0ff;
      --muted: #555577;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      width: 100%; height: 100%;
      overflow: hidden;
    }

    body {
      background: var(--bg);
      font-family: 'Space Mono', monospace;
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #bgCanvas {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }

    .app {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: min(420px, 96vw);
      padding: 20px 20px 16px;
      gap: 14px;
      background: rgba(10,10,20,0.72);
      border: 1px solid var(--border);
      border-radius: 28px;
      backdrop-filter: blur(28px);
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.04) inset,
        0 40px 80px rgba(0,0,0,0.65);
      animation: appIn 0.8s cubic-bezier(0.16,1,0.3,1) both;
    }
    @keyframes appIn {
      from { opacity:0; transform: translateY(40px) scale(0.95); }
      to   { opacity:1; transform: translateY(0) scale(1); }
    }

    /* HEADER */
    .header {
      text-align: center;
      animation: fadeDown 0.6s 0.2s both;
    }
    @keyframes fadeDown {
      from { opacity:0; transform:translateY(-16px); }
      to   { opacity:1; transform:translateY(0); }
    }
    .header h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(52px, 14vw, 70px);
      letter-spacing: 10px;
      line-height: 1;
      color: var(--gold);
      text-shadow:
        0 0 20px rgba(247,204,64,0.6),
        0 0 60px rgba(247,204,64,0.3),
        0 0 100px rgba(247,204,64,0.1);
      animation: titlePulse 3s ease-in-out infinite;
    }
    @keyframes titlePulse {
      0%,100% { text-shadow: 0 0 20px rgba(247,204,64,0.6), 0 0 60px rgba(247,204,64,0.3); }
      50%     { text-shadow: 0 0 35px rgba(247,204,64,1), 0 0 90px rgba(247,204,64,0.5), 0 0 140px rgba(247,204,64,0.2); }
    }
    .header .sub {
      font-size: 9px;
      letter-spacing: 4px;
      color: var(--muted);
      text-transform: uppercase;
      margin-top: 2px;
    }

    /* SCOREBOARD */
    .scoreboard {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      width: 100%;
      animation: fadeUp 0.6s 0.3s both;
    }
    @keyframes fadeUp {
      from { opacity:0; transform:translateY(16px); }
      to   { opacity:1; transform:translateY(0); }
    }
    .score-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 11px 8px 9px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .score-card::before {
      content: '';
      position: absolute;
      top: 0; left: 50%;
      transform: translateX(-50%);
      width: 60%; height: 1px;
      background: linear-gradient(90deg, transparent, var(--acc, #fff), transparent);
      opacity: 0.35;
    }
    .score-card.wins   { --acc: var(--green); }
    .score-card.losses { --acc: var(--red); }
    .score-card.streak { --acc: var(--gold); }
    .score-card .lbl {
      font-size: 8px; letter-spacing: 3px;
      text-transform: uppercase; color: var(--muted); margin-bottom: 3px;
    }
    .score-card .num {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 34px; letter-spacing: 2px; line-height: 1;
      transition: transform 0.15s, color 0.3s;
    }
    .score-card.wins   .num { color: var(--green); }
    .score-card.losses .num { color: var(--red); }
    .score-card.streak .num { color: var(--gold); }
    .num.bump { animation: numBump 0.35s cubic-bezier(0.34,1.56,0.64,1); }
    @keyframes numBump {
      0%  { transform: scale(1); }
      50% { transform: scale(1.5); }
      100%{ transform: scale(1); }
    }
    .streak-tag {
      position: absolute; top: -6px; right: -6px;
      background: var(--gold); color: #000;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 10px; letter-spacing: 1px;
      padding: 2px 6px; border-radius: 20px;
      opacity: 0; transform: scale(0.5) rotate(10deg);
      transition: opacity 0.3s, transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
      pointer-events: none; white-space: nowrap;
    }
    .streak-tag.show { opacity:1; transform: scale(1) rotate(-3deg); }

    /* ARENA */
    .arena {
      position: relative;
      width: min(210px, 52vw);
      height: min(210px, 52vw);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeUp 0.6s 0.45s both;
    }
    .ring {
      position: absolute;
      border-radius: 50%;
      border: 1px solid transparent;
    }
    .ring:nth-child(1) {
      inset: 0;
      border-color: rgba(247,204,64,0.12);
      animation: spinRing 12s linear infinite;
    }
    .ring:nth-child(2) {
      inset: -14px;
      border-color: rgba(247,204,64,0.06);
      animation: spinRing 22s linear infinite reverse;
    }
    .ring:nth-child(3) {
      inset: -28px;
      border-color: rgba(68,136,255,0.05);
      animation: spinRing 35s linear infinite;
    }
    .ring::after {
      content:'';
      position: absolute;
      width: 6px; height: 6px;
      background: var(--gold);
      border-radius: 50%;
      top: 50%; left: -3px;
      transform: translateY(-50%);
      box-shadow: 0 0 10px var(--gold);
      opacity: 0.7;
    }
    @keyframes spinRing { to { transform: rotate(360deg); } }

    .arena-glow {
      position: absolute; inset: -30px; border-radius: 50%;
      pointer-events: none; transition: background 0.4s;
    }
    .coin-shadow {
      position: absolute;
      bottom: 7%; left: 50%; transform: translateX(-50%);
      width: 50%; height: 7%;
      background: radial-gradient(ellipse, rgba(0,0,0,0.55), transparent 70%);
      border-radius: 50%;
      transition: opacity 0.3s;
    }

    /* COIN */
    .coin-wrapper {
      perspective: 1000px;
      width: 60%; height: 60%;
    }
    .coin {
      width: 100%; height: 100%;
      transform-style: preserve-3d;
      position: relative;
      animation: breathe-heads 3s ease-in-out infinite;
    }
    /* Idle float for each face */
    @keyframes breathe-heads {
      0%,100% { transform: rotateY(0deg)   translateY(0px); }
      50%      { transform: rotateY(0deg)   translateY(-7px); }
    }
    @keyframes breathe-tails {
      0%,100% { transform: rotateY(180deg) translateY(0px); }
      50%      { transform: rotateY(180deg) translateY(-7px); }
    }
    .coin.show-tails { animation: breathe-tails 3s ease-in-out infinite; }

    /* Flip to heads: ends at 0deg (or 360deg) */
    .coin.flip-to-heads {
      animation: flipToHeads 1s cubic-bezier(0.25,0.1,0.25,1) forwards;
    }
    @keyframes flipToHeads {
      0%   { transform: rotateY(0deg)    translateY(0px)   scale(1); }
      15%  { transform: rotateY(270deg)  translateY(-22px) scale(1.06); }
      35%  { transform: rotateY(540deg)  translateY(-48px) scale(1.12); }
      55%  { transform: rotateY(810deg)  translateY(-22px) scale(1.06); }
      75%  { transform: rotateY(1080deg) translateY(9px)   scale(0.97); }
      87%  { transform: rotateY(1080deg) translateY(-4px)  scale(1.01); }
      95%  { transform: rotateY(1080deg) translateY(2px)   scale(0.99); }
      100% { transform: rotateY(1080deg) translateY(0px)   scale(1); }
    }
    /* Flip to tails: ends at 180deg (or 900deg = 180 mod 360) */
    .coin.flip-to-tails {
      animation: flipToTails 1s cubic-bezier(0.25,0.1,0.25,1) forwards;
    }
    @keyframes flipToTails {
      0%   { transform: rotateY(0deg)   translateY(0px)   scale(1); }
      15%  { transform: rotateY(270deg) translateY(-22px) scale(1.06); }
      35%  { transform: rotateY(540deg) translateY(-48px) scale(1.12); }
      55%  { transform: rotateY(810deg) translateY(-22px) scale(1.06); }
      75%  { transform: rotateY(900deg) translateY(9px)   scale(0.97); }
      87%  { transform: rotateY(900deg) translateY(-4px)  scale(1.01); }
      95%  { transform: rotateY(900deg) translateY(2px)   scale(0.99); }
      100% { transform: rotateY(900deg) translateY(0px)   scale(1); }
    }
    .coin-face {
      position: absolute; inset: 0; border-radius: 50%;
      backface-visibility: hidden;
      display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px;
    }
    .face-h {
      background: radial-gradient(circle at 38% 32%, #fffbe0 0%, #f7cc40 30%, #c8920a 75%, #8a5f00 100%);
      box-shadow:
        inset 0 -6px 16px rgba(0,0,0,0.35),
        inset 5px 5px 14px rgba(255,255,255,0.45),
        0 10px 40px rgba(247,204,64,0.55),
        0 0 0 5px rgba(247,204,64,0.14),
        0 0 0 10px rgba(247,204,64,0.05);
    }
    .face-t {
      background: radial-gradient(circle at 38% 32%, #f5e280 0%, #d4a012 35%, #8a6000 75%, #5a3d00 100%);
      box-shadow:
        inset 0 -6px 16px rgba(0,0,0,0.4),
        inset 5px 5px 14px rgba(255,255,255,0.25),
        0 10px 40px rgba(180,130,20,0.4),
        0 0 0 5px rgba(200,150,20,0.1);
      transform: rotateY(180deg);
    }
    .coin-face::after {
      content:''; position:absolute; inset:8px;
      border-radius:50%; border:1.5px solid rgba(0,0,0,0.18);
    }
    .coin-face::before {
      content:''; position:absolute; inset:15px;
      border-radius:50%; border:0.5px solid rgba(255,255,255,0.18);
    }
    .coin-glyph {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(34px, 8vw, 52px);
      color: rgba(0,0,0,0.45); line-height:1; user-select:none;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2), 0 -1px 0 rgba(255,255,255,0.2);
    }
    .coin-sub {
      font-family: 'Space Mono', monospace;
      font-size: 7px; letter-spacing: 3px;
      color: rgba(0,0,0,0.35); text-transform: uppercase;
    }

    /* SHOCKWAVE */
    .shockwave {
      position:absolute; inset:0; border-radius:50%;
      border: 2px solid currentColor; opacity:0; pointer-events:none;
    }
    .shockwave.fire { animation: shockwave 0.7s ease-out forwards; }
    @keyframes shockwave {
      0%   { opacity:0.9; transform:scale(0.7); }
      100% { opacity:0;   transform:scale(2.4); }
    }

    /* PARTICLES */
    #particleCanvas {
      position:fixed; inset:0; pointer-events:none; z-index:10;
    }

    /* RESULT */
    .result-wrap {
      height: 42px;
      display: flex; align-items: center; justify-content: center;
      width:100%;
      animation: fadeUp 0.6s 0.5s both;
    }
    .result-txt {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(20px, 5.5vw, 28px);
      letter-spacing: 5px;
      opacity:0; transform: scale(0.8) translateY(8px);
      transition: opacity 0.35s, transform 0.35s cubic-bezier(0.34,1.56,0.64,1), color 0.3s;
    }
    .result-txt.show  { opacity:1; transform: scale(1) translateY(0); }
    .result-txt.win   { color: var(--green); filter: drop-shadow(0 0 14px rgba(0,255,136,0.7)); }
    .result-txt.lose  { color: var(--red);   filter: drop-shadow(0 0 14px rgba(255,51,85,0.7)); }
    .result-txt.idle  { color: var(--gold); }

    /* BUTTONS */
    .bet-row {
      display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
      width:100%;
      animation: fadeUp 0.6s 0.6s both;
    }
    .bet-btn {
      position:relative;
      padding: 16px 10px 12px;
      border:none; border-radius:18px;
      cursor:pointer;
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(20px, 5vw, 26px);
      letter-spacing: 4px;
      overflow:hidden;
      transition: transform 0.18s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.2s, opacity 0.2s;
    }
    /* Shimmer */
    .bet-btn::after {
      content:''; position:absolute;
      top:0; left:-100%; width:60%; height:100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.13), transparent);
      transform: skewX(-20deg); transition: left 0.5s;
    }
    .bet-btn:hover:not(:disabled)::after { left:160%; }
    .bet-btn:hover:not(:disabled) { transform: translateY(-3px) scale(1.03); }
    .bet-btn:active:not(:disabled) { transform: translateY(0) scale(0.97); }
    .bet-btn:disabled { opacity:0.32; cursor:not-allowed; transform:none; }

    .btn-h {
      background: linear-gradient(145deg, #0e2010, #091509);
      color: var(--green);
      border: 1px solid rgba(0,255,136,0.22);
      box-shadow: 0 4px 20px rgba(0,255,136,0.08), inset 0 1px 0 rgba(0,255,136,0.1);
    }
    .btn-h:hover:not(:disabled) { box-shadow: 0 10px 32px rgba(0,255,136,0.22), inset 0 1px 0 rgba(0,255,136,0.18); }
    .btn-t {
      background: linear-gradient(145deg, #200e10, #150909);
      color: var(--red);
      border: 1px solid rgba(255,51,85,0.22);
      box-shadow: 0 4px 20px rgba(255,51,85,0.08), inset 0 1px 0 rgba(255,51,85,0.1);
    }
    .btn-t:hover:not(:disabled) { box-shadow: 0 10px 32px rgba(255,51,85,0.22), inset 0 1px 0 rgba(255,51,85,0.18); }

    .btn-label { display:block; }
    .btn-hint {
      display:block; font-family:'Space Mono',monospace;
      font-size:8px; letter-spacing:2px; opacity:0.4;
      margin-top:3px; text-transform:uppercase;
    }

    /* RESET */
    .reset-btn {
      background:none; border:1px solid rgba(255,255,255,0.1);
      color:var(--muted); padding:9px 28px; border-radius:50px;
      cursor:pointer; font-family:'Space Mono',monospace;
      font-size:9px; letter-spacing:3px; text-transform:uppercase;
      transition: all 0.22s;
      animation: fadeUp 0.6s 0.7s both;
    }
    .reset-btn:hover {
      border-color:rgba(255,255,255,0.28); color:var(--text);
      background:rgba(255,255,255,0.05); letter-spacing:4px;
    }

    /* SCREEN FLASH */
    #flash {
      position:fixed; inset:0; pointer-events:none; z-index:50; opacity:0;
    }
    #flash.pop { animation: flashPop 0.55s ease-out forwards; }
    @keyframes flashPop {
      0%   { opacity:0.16; }
      100% { opacity:0; }
    }

    /* BIG BANNER */
    #banner {
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%) scale(0);
      z-index:30; font-family:'Bebas Neue',sans-serif;
      font-size: clamp(60px,18vw,110px);
      letter-spacing:8px; pointer-events:none; opacity:0;
    }
    #banner.pop-win {
      color:var(--green); text-shadow:0 0 40px rgba(0,255,136,0.9);
      animation: bannerPop 1s cubic-bezier(0.34,1.56,0.64,1) forwards;
    }
    #banner.pop-lose {
      color:var(--red); text-shadow:0 0 40px rgba(255,51,85,0.9);
      animation: bannerPop 1s cubic-bezier(0.34,1.56,0.64,1) forwards;
    }
    @keyframes bannerPop {
      0%   { opacity:0; transform:translate(-50%,-50%) scale(0.3); }
      35%  { opacity:1; transform:translate(-50%,-50%) scale(1.08); }
      60%  { opacity:1; transform:translate(-50%,-50%) scale(1); }
      100% { opacity:0; transform:translate(-50%,-50%) scale(0.75) translateY(-40px); }
    }

    /* FLOATING +1 / -1 */
    .float-num {
      position:fixed; font-family:'Bebas Neue',sans-serif; font-size:38px;
      letter-spacing:2px; pointer-events:none; z-index:20;
      animation: floatUp 1.1s ease-out forwards;
    }
    @keyframes floatUp {
      0%   { opacity:1; transform:translateX(-50%) translateY(0) scale(1); }
      50%  { opacity:1; transform:translateX(-50%) translateY(-55px) scale(1.2); }
      100% { opacity:0; transform:translateX(-50%) translateY(-95px) scale(0.8); }
    }
  </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>
<canvas id="particleCanvas"></canvas>
<div id="flash"></div>
<div id="banner"></div>

<div class="app">

  <div class="header">
    <h1>FLIP</h1>
    <div class="sub">Call it in the air</div>
  </div>

  <div class="scoreboard">
    <div class="score-card wins">
      <div class="lbl">Wins</div>
      <div class="num" id="winsNum">0</div>
    </div>
    <div class="score-card losses">
      <div class="lbl">Losses</div>
      <div class="num" id="lossesNum">0</div>
    </div>
    <div class="score-card streak" style="position:relative">
      <div class="lbl">Streak</div>
      <div class="num" id="streakNum">0</div>
      <div class="streak-tag" id="streakTag">ðŸ”¥ HOT</div>
    </div>
  </div>

  <div class="arena" id="arena">
    <div class="ring"></div>
    <div class="ring"></div>
    <div class="ring"></div>
    <div class="arena-glow" id="arenaGlow"></div>
    <div class="coin-shadow" id="coinShadow"></div>
    <div class="coin-wrapper">
      <div class="coin" id="coin">
        <div class="coin-face face-h">
          <span class="coin-glyph">H</span>
          <span class="coin-sub">Heads</span>
        </div>
        <div class="coin-face face-t">
          <span class="coin-glyph">T</span>
          <span class="coin-sub">Tails</span>
        </div>
      </div>
    </div>
    <div class="shockwave" id="shockwave"></div>
  </div>

  <div class="result-wrap">
    <div class="result-txt" id="resultTxt"></div>
  </div>

  <div class="bet-row">
    <button class="bet-btn btn-h" id="btnH" onclick="play('Heads')">
      <span class="btn-label">HEADS</span>
      <span class="btn-hint">Pick heads</span>
    </button>
    <button class="bet-btn btn-t" id="btnT" onclick="play('Tails')">
      <span class="btn-label">TAILS</span>
      <span class="btn-hint">Pick tails</span>
    </button>
  </div>

  <button class="reset-btn" onclick="resetGame()">â†º &nbsp;Reset</button>

</div>

<script>
// â”€â”€ ANIMATED BACKGROUND â”€â”€
const bgC = document.getElementById('bgCanvas');
const bgX = bgC.getContext('2d');
let W, H;
function resizeBg() { W = bgC.width = window.innerWidth; H = bgC.height = window.innerHeight; }
resizeBg();
window.addEventListener('resize', resizeBg);

const stars = Array.from({length:220}, () => ({
  x: Math.random(), y: Math.random(),
  r: Math.random() * 1.5 + 0.2,
  a: Math.random(),
  speed: Math.random() * 0.003 + 0.001,
  phase: Math.random() * Math.PI * 2,
}));

let bgT = 0;
function drawBg() {
  bgX.clearRect(0,0,W,H);
  const t = bgT * 0.0003;
  const blobs = [
    {x:0.28+Math.sin(t)*0.1, y:0.4+Math.cos(t*0.7)*0.1, r:0.38, c:'110,50,255'},
    {x:0.72+Math.cos(t*0.8)*0.1, y:0.28+Math.sin(t*1.1)*0.08, r:0.32, c:'255,90,40'},
    {x:0.5+Math.sin(t*1.3)*0.09, y:0.72+Math.cos(t*0.9)*0.08, r:0.3, c:'247,204,64'},
  ];
  blobs.forEach(b => {
    const g = bgX.createRadialGradient(b.x*W, b.y*H, 0, b.x*W, b.y*H, b.r*Math.max(W,H));
    g.addColorStop(0, `rgba(${b.c},0.07)`);
    g.addColorStop(1, `rgba(${b.c},0)`);
    bgX.fillStyle = g;
    bgX.fillRect(0,0,W,H);
  });
  stars.forEach(s => {
    const pulse = 0.3 + 0.7*(0.5 + 0.5*Math.sin(bgT*s.speed*60+s.phase));
    bgX.beginPath();
    bgX.arc(s.x*W, s.y*H, s.r, 0, Math.PI*2);
    bgX.fillStyle = `rgba(255,255,255,${s.a*pulse*0.55})`;
    bgX.fill();
  });
  bgT++;
  requestAnimationFrame(drawBg);
}
drawBg();

// â”€â”€ PARTICLE SYSTEM â”€â”€
const pC = document.getElementById('particleCanvas');
const pX = pC.getContext('2d');
let pW, pH;
function resizeP() { pW = pC.width = window.innerWidth; pH = pC.height = window.innerHeight; }
resizeP();
window.addEventListener('resize', resizeP);

let particles = [];

function spawnParticles(x, y, type) {
  const pal = type === 'win'
    ? ['#00ff88','#69ffb8','#b9ffd9','#f7cc40','#ffffff','#80ffcc']
    : ['#ff3355','#ff6677','#ffaa99','#ff6600','#ffcc00'];
  const n = type === 'win' ? 70 : 45;
  for (let i = 0; i < n; i++) {
    const angle = (Math.PI*2/n)*i + (Math.random()-0.5)*0.6;
    const spd = 3 + Math.random() * 9;
    const sz = 3 + Math.random() * 6;
    const shapes = ['circle','rect','tri'];
    particles.push({
      x, y,
      vx: Math.cos(angle)*spd,
      vy: Math.sin(angle)*spd - Math.random()*5,
      size: sz,
      shape: shapes[Math.floor(Math.random()*shapes.length)],
      color: pal[Math.floor(Math.random()*pal.length)],
      alpha: 1,
      rot: Math.random()*Math.PI*2,
      rotSpeed: (Math.random()-0.5)*0.35,
      life:0,
      maxLife: 65 + Math.random()*50,
    });
  }
}

function updateParticles() {
  pX.clearRect(0,0,pW,pH);
  particles = particles.filter(p => p.life < p.maxLife);
  particles.forEach(p => {
    p.x += p.vx; p.y += p.vy;
    p.vy += 0.2; p.vx *= 0.985;
    p.rot += p.rotSpeed; p.life++;
    p.alpha = 1 - p.life/p.maxLife;
    pX.globalAlpha = p.alpha;
    pX.fillStyle = p.color;
    pX.save(); pX.translate(p.x, p.y); pX.rotate(p.rot);
    if (p.shape === 'rect') {
      pX.fillRect(-p.size/2, -p.size/4, p.size, p.size/2);
    } else if (p.shape === 'tri') {
      pX.beginPath();
      pX.moveTo(0,-p.size/2); pX.lineTo(p.size/2, p.size/2); pX.lineTo(-p.size/2, p.size/2);
      pX.closePath(); pX.fill();
    } else {
      pX.beginPath(); pX.arc(0,0,p.size/2,0,Math.PI*2); pX.fill();
    }
    pX.restore();
  });
  pX.globalAlpha = 1;
  requestAnimationFrame(updateParticles);
}
updateParticles();

// â”€â”€ GAME LOGIC â”€â”€
let wins=0, losses=0, streak=0, flipping=false;

const coinEl    = document.getElementById('coin');
const resultTxt = document.getElementById('resultTxt');
const arenaGlow = document.getElementById('arenaGlow');
const shockwave = document.getElementById('shockwave');
const banner    = document.getElementById('banner');
const flash     = document.getElementById('flash');
const shadow    = document.getElementById('coinShadow');
const streakTag = document.getElementById('streakTag');

function play(guess) {
  if (flipping) return;
  flipping = true;
  document.getElementById('btnH').disabled = true;
  document.getElementById('btnT').disabled = true;

  coinEl.style.animation = 'none';
  shadow.style.opacity   = '0.25';
  resultTxt.className    = 'result-txt idle show';
  resultTxt.textContent  = 'FLIPPING...';
  arenaGlow.style.background = 'radial-gradient(circle, rgba(247,204,64,0.18) 30%, transparent 70%)';

  void coinEl.offsetWidth;
  coinEl.classList.add('flipping');

  setTimeout(() => {
    const outcome = Math.random() < 0.5 ? 'Heads' : 'Tails';
    const won     = guess === outcome;

    coinEl.style.animation  = 'none';
    coinEl.style.transition = 'none';
    coinEl.style.transform  = outcome === 'Tails' ? 'rotateY(180deg)' : 'rotateY(360deg)';
    shadow.style.opacity    = '0.65';

    const arena = document.getElementById('arena');
    const rect  = arena.getBoundingClientRect();
    const cx    = rect.left + rect.width  / 2;
    const cy    = rect.top  + rect.height / 2;

    if (won) {
      wins++;
      streak = streak >= 0 ? streak+1 : 1;
      resultTxt.className = 'result-txt win show';
      resultTxt.textContent = `âœ“ ${outcome.toUpperCase()} â€” YOU WIN!`;
      arenaGlow.style.background = 'radial-gradient(circle, rgba(0,255,136,0.18) 30%, transparent 70%)';
      flash.style.background = '#00ff88';
      spawnParticles(cx, cy, 'win');
      fireShockwave('var(--green)');
      showBanner('WIN!', 'pop-win');
      bump('winsNum');
    } else {
      losses++;
      streak = streak <= 0 ? streak-1 : -1;
      resultTxt.className = 'result-txt lose show';
      resultTxt.textContent = `âœ— ${outcome.toUpperCase()} â€” YOU LOSE`;
      arenaGlow.style.background = 'radial-gradient(circle, rgba(255,51,85,0.18) 30%, transparent 70%)';
      flash.style.background = '#ff3355';
      spawnParticles(cx, cy, 'lose');
      fireShockwave('var(--red)');
      showBanner('NOPE', 'pop-lose');
      bump('lossesNum');
    }

    flash.classList.remove('pop');
    void flash.offsetWidth;
    flash.classList.add('pop');

    floatNum(cx, cy - 50, won ? '+1' : '-1', won ? '#00ff88' : '#ff3355');

    updateUI(); save();
    flipping = false;
    document.getElementById('btnH').disabled = false;
    document.getElementById('btnT').disabled = false;

    setTimeout(() => {
      coinEl.style.transition = '';
      coinEl.style.animation  = 'breathe 3s ease-in-out infinite';
    }, 200);
  }, 1000);
}

function fireShockwave(color) {
  shockwave.style.color = color;
  shockwave.classList.remove('fire');
  void shockwave.offsetWidth;
  shockwave.classList.add('fire');
}

function showBanner(txt, cls) {
  banner.textContent = txt;
  banner.className   = '';
  void banner.offsetWidth;
  banner.className   = cls;
}

function floatNum(x, y, txt, color) {
  const el = document.createElement('div');
  el.className = 'float-num';
  el.textContent = txt;
  el.style.cssText = `left:${x}px;top:${y}px;color:${color};`;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 1200);
}

function bump(id) {
  const el = document.getElementById(id);
  el.classList.remove('bump');
  void el.offsetWidth;
  el.classList.add('bump');
}

function updateUI() {
  document.getElementById('winsNum').textContent   = wins;
  document.getElementById('lossesNum').textContent = losses;
  document.getElementById('streakNum').textContent = streak;
  const abs = Math.abs(streak);
  if (abs >= 3) {
    streakTag.textContent = streak > 0 ? 'ðŸ”¥ HOT' : 'ðŸ¥¶ COLD';
    streakTag.classList.add('show');
  } else {
    streakTag.classList.remove('show');
  }
}

function resetGame() {
  if (flipping) return;
  wins=0; losses=0; streak=0;
  coinEl.style.transform  = '';
  coinEl.style.animation  = 'breathe 3s ease-in-out infinite';
  resultTxt.className     = 'result-txt';
  resultTxt.textContent   = '';
  arenaGlow.style.background = '';
  shadow.style.opacity    = '0.6';
  streakTag.classList.remove('show');
  updateUI();
  localStorage.removeItem('cf3');
}

function save() {
  localStorage.setItem('cf3', JSON.stringify({wins,losses,streak}));
}
function load() {
  try {
    const d = JSON.parse(localStorage.getItem('cf3'));
    if (d) { wins=d.wins||0; losses=d.losses||0; streak=d.streak||0; updateUI(); }
  } catch(e) {}
}
load();
</script>
</body>
</html>
